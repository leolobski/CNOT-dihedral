# Normalising quantum circuits
<!-- ideas for the title: Normalising quantum circuits / Towards simplification of quantum circuits -->
*guest post by [Giovanni de Felice](author1&#x2019;s url) and [Leo Lobski](https://leolobski.github.io/)*

We begin the [Applied Category Theory School](http://www.appliedcategorytheory.org/adjoint-school-act-2019/) with a discussion inspired by the paper [A Finite Presentation of CNOT-Dihedral Operators](https://arxiv.org/abs/1701.00140) by Matthew Amy, Jianxin Chen and Niel J. Ross. The result of the paper, existence and uniqueness of a normal form for a fragment of quantum computation, was obtained by the authors by observing an interesting interplay between two languages: on one hand we have the representation of quantum gates as circuits in a symmetric monoidal category (which is moreover a groupoid in this case), and on the other hand we can view the diagonal gates as 'phase polynomials'. When trying to understand a new field, subject or theory, it is often useful to view it from as many angles as possible. In mathematics, this involves studying various representations of an object. In this blog post, we thus add a third language to the ones introduced in the paper, the ZX-calculus. This, inter alia, serves the purpose of putting the work done in the paper into a broader context, as the ZX-calculus is already implicit in the monoidal circuit representation; indeed, all the relations that hold for the gates in the paper are derivable in the ZX-calculus.

## Introduction

Quantum computation aims to use properties unique to quantum mechanical systems for designing processes and algorithms which would be either hard or impossible for a classical computer. To reason about quantum computation, it is useful to consider *circuit diagrams*. These consist of two basic components. Each line, or wire, of the circuit diagram represents a *qubit*, which is just a normalised state in a complex Hilbert space. It is useful to think of qubits as points on the [Bloch sphere](https://en.wikipedia.org/wiki/Bloch_sphere). Wires of a circuit diagram connect to boxes, which represent *operations* that can be done on qubits. These are all maps which maps points on the Bloch sphere to points on the Bloch sphere, which is to say all the unitary linear transformations.

Since quantum circuits can be composed both 'horizontally' (do one process after another) and 'vertically' (do operations on multiple qubits at the same time), the language of monoidal categories captures their essence. More than that, graphical languages mimicking the rules of monoidal categories can be extremely helpful when proving results about the circuits.

<!-- Algebraic theory of quantum circuits: logical vs reversible gates. -->

Logical quantum gates, that is, all linear maps (without the restriction to the unitaries), have been axiomatised in the ZX and ZW calculi, both forming compact closed monoidal categories. An axiomatisation of unitary circuits, in the form of a symmetric monoidal groupoid, is a harder task. A commonly studied unitary fragment of quantum circuits is known as *Clifford+T*, and it consists of the gates $C N O T$ (controlled not), $T$ (rotation by $\frac{\pi}{4}$) and $H$ (the Hadamard gate, corresponding to the basis change between two complimentary bases). What makes this gate set of particular interest is that while it is finitely generated, it is *approximately universal* for quantum computation, meaning that we can get arbitrarily close to any $n$-qubit unitary using polynomially many gates (see the survey paper by [Miller-Bakewell](https://github.com/Quantomatic/outreach/blob/master/survey-paper/ZXCalculusSurvey.pdf).

Some prior work on algebraic theories for restricted fragments of quantum computation include:

* [Lafont](http://iml.univ-mrs.fr/~lafont/pub/circuits.pdf) (2003): normal form for 'affine circuits' $\{C N O T, X\}$,

* [Selinger](https://arxiv.org/abs/1310.6813v3) (2015): Clifford groupoid $\{C N O T, X, H, T^2\}$.

In this paper the focus is on CNOT-dihedral gates, i.e. those gates generated by $C N O T$, $X$ and $T$. Clifford gates considered by Selinger are efficiently classically simulatable. Thus what really gives the approximate universality of the Clifford+T fragment is the presence of the $T$-gate. This gate, however, is hard to implement in a lab. It is therefore a worthwhile exercise to try and reduce the $T$-count of a given quantum circuit. At the end of this blog post, we will look into how the results of the paper can be used to reduce the number of $T$ gates in a circuit. For more background on this, we direct the reader to

* Amy et al. ([2013](https://arxiv.org/abs/1206.0758), [2016](https://arxiv.org/abs/1601.07363)): phase polynomials for $T$-count optimization in the fragment generated by $\{CNOT, T\}$.

## Brief overview of the paper

The paper proves existence and uniqueness of a normal for the circuits generated by the CNOT-dihedral operators, which are defined below [Amy, Chen and Ross. p.86].

<img width = "700" src = "https://raw.githubusercontent.com/leolobski/CNOT-dihedral/master/assets/CNOT-gates.png"
alt = ""/>

An important step towards the normal form is the observation that the operators can be split into two classes: diagonal gates and affine gates. The diagonal gates have a diagonal matrix representations, while the affine ones are affine transformations of the basis states. The gates $X$, $C N O T$ and $S W A P$ are affine, while $\omega$, $T$, $U$ and $V$ are diagonal. Those CNOT-dihedral circuits that only cont&#803;ain affine gates are called affine circuits, and correspondingly for diagonal circuits.

The gates are subject to the following relations. [Amy, Chen and Ross. p.87].

<img width = "700" src = "https://raw.githubusercontent.com/leolobski/CNOT-dihedral/master/assets/relations.png"
alt = ""/>

One central point to notice here are the *degree reduction* rules $R_1$, $R_4$, $R_7$, $R_8$, $R_9$ and $R_10$, which yield an upper bound on the power of each gate in the normal form. The degree reduction rules also have a direct interpretation in terms of phase polynomial equalities. We will discuss the phase polynomial representation in more detail in the third section. All of these relations are derivable in the ZX-calculus, making the CNOT-dihedral gates a proper fragment thereof.

The normal forms for affine and diagonal circuits turn out to be different, and the overall normal form is a combination of the two. In fact, existence and uniqueness of the normal form for affine gates was already proved by [Lafont](http://iml.univ-mrs.fr/~lafont/pub/circuits.pdf). Thus, what is proved in the present paper is that

* if an affine gate is to the left of a diagonal gate, the circuit can be rewritten in such a way that the affine gate is the rightmost gate and all the remaining gates are diagonal (i.e. affine gates 'commute' past the diagonal ones),

* diagonal gates commute with diagonal gates,

* any diagonal circuit has a unique normal form.

It then follows that any CNOT-dihedral circuit $C$ can be rearranged so that $C = D A$, where $D$ is a diagonal circuit and $A$ an affine one. Then one can just apply the result of Lafont to $A$ and the last bullet point above to $D$ to get that $C$ has a unique normal form.

The diagonal normal form they provide is given by an ordering of the diagonal gates, together with bounds on the number of consecutive gates used, which comes from their representation in terms of phase polynomials.

<!-- The first step towards a normal form is to show that the gates $\omega, T, U, V$ generate all diagonal gates in the fragment. They give a small number of relations on these generators which allow to show that they commute with affine gates and between themselves. -->


### From ZX to CNOT-Dihedral rules

In order to get an intuition for the presentation given in the paper, we make a short digression to briefly introduce some of the ZX-calculus rules. This will allow us to understand the rules exposed in the paper as direct consequences of the underlying rules for logical gates (linear maps) modelled with the ZX-calculus. It will also highlight the rules which are not directly derivable from ZX, which we will see come from the phase polynomial formalism.

The ZX calculus is based on (strongly) complementary bases, roughly meaning that measurements cannot be performed simultaneously in both bases. The generators (processes or measurements) in these bases are denoted by dots of different colour, traditionally red and green, decorated with a phase. The generators (known as *spiders* or *dagger special Frobenius algebras*)

<img width = "700" src = "https://raw.githubusercontent.com/leolobski/CNOT-dihedral/master/assets/ZX-generators.png"
alt = ""/>

with $n$ inputs and $m$ outputs (the diagrams are read from left to right) correspond to linear maps

<img width = "700" src = "https://raw.githubusercontent.com/leolobski/CNOT-dihedral/master/assets/linearmaps.png"
alt = ""/>

where $|\plusminus\rangle = \frac{1}{\sqrt 2}(|0\rangle \plusminus |1\rangle)$ and $\alpha\in(-\pi,\pi]$ (see e.g. [Backens](https://arxiv.org/abs/1307.7025) or [Miller-Bakewell](https://github.com/Quantomatic/outreach/blob/master/survey-paper/ZXCalculusSurvey.pdf) for a proper definition). The spiders can be thought of as generalised rotations; indeed, for a single qubit (n=1) they correspond to rotating the second basis vector by degree $\alpha$.

The rule governing the interaction between generators of the same colour is the *spider fusion law* (a consequence of the axioms of dagger special Frobenius algebras), which states that spiders of the same colour can fuse into each other and their phases add up (modulo $2\pi$). This is in direct analogy with rotations: two consecutive rotations (around the same axis) correspond to one rotation by an angle which is just the sum of the two angles, and going a full turn gets you back to where you started.

The basic rules encoding strong complementarity are the bialgebra and Hopf laws.

<img width = "700" src = "https://raw.githubusercontent.com/leolobski/CNOT-dihedral/master/assets/hopf-bialgebra.png"
alt = ""/>

The CNOT-dihedral fragment can be expressed in ZX, it is given by the following representations of the generators.

<img width = "700" src = "https://raw.githubusercontent.com/leolobski/CNOT-dihedral/master/assets/CNOT-generators.png"
alt = ""/>

This can then be used to obtain the representations for the derived generators.

<img width = "700" src = "https://raw.githubusercontent.com/leolobski/CNOT-dihedral/master/assets/CNOT-derived.png"
alt = ""/>

Given the interpretation of the ZX generators as rotations, the relations $R_1$ and $R_7$ now acquire a physical meaning; rotating by $\pi$ twice is the same as doing nothing, and likewise rotating by $\frac{\pi}{4}$ eight times is the same as doing nothing.

Most of the relations $R_1$ to $R_{13}$ can be derived using the spider fusion law, the Hopf law and the bialgebra law. Rules 9 and 13 are the least straightforward, in fact we don't know of any direct derivation of rule 13 from the axioms, although by the recent completeness results for the ZX calculus such a derivation must exist. Those rules however have a direct interpretation in terms of their phase polynomial representation.


## Phase polynomials

The action of any&#803; diagonal gate from the CNOT-dihedral fragment can be described as follows:
$$ D |x\rangle = \omega^{p_D(x)}|x\rangle, \quad p_D: \mathbb{Z}_2^n \rightarrow \mathbb{Z}_8 ,$$
Where $p_D$ is a polynomial using mixed arithmetic:
$$ p_D(x) = \sum_{i=1}^k a_i g_i(x) $$
where $a_i \in \mathbb{Z}_8$ and $g_i:\mathbb{Z}_2^n \rightarrow \mathbb{Z}_2$ are linear terms on at most $n$ variables, i.e. terms of the form $x_{i_1} \oplus \dots \oplus x_{i_k}$ for some $k \leq n$ (this was shown in [Amy et al.](https://arxiv.org/abs/1206.0758)).
Representations for the generating diagonal gates are given by:

$$ \omega^k |x\rangle = \omega^k |x\rangle $$
$$ T^k |x_1\rangle = \omega^{kx_1}|x_1\rangle$$
$$ U^k |x_1x_2\rangle = \omega^{k(x_1\oplus x_2)}|x_1x_2\rangle$$
$$ V^k |x_1x_2x_3\rangle = \omega^{k(x_1\oplus x_2 \oplus x_3)}|x_1x_2x_3\rangle$$

We can read off the phase polynomial of a circuit on $n$ qubits built from the diagonal generators by labeling each wire with an index $i=1,2, \dots, n$ (from top to bottom say) and adding: a constant term $1$ for each scalar $\omega$, a term $x_i$ whenever $T$ is applied to qubit $i$, a term $x_i \oplus x_j$ whenever $U$ is applied to qubits $i$ and $j$ and a term $x_i \oplus x_j \oplus x_k$ whenever $V$ is applied to qubits $i$,$j$ and $k$. Note that the order doesn't matter as diagonal gates commute. So we obtain the following general form:

$$ p_D(x) = a_0 + \sum_i a_i x_i + \sum_{i < j}b_{i j} (x_i \oplus x_j) + \sum_{i < j < k}c_{i j k} (x_i \oplus x_j \oplus x_k)$$

The important thing to note is that using the degree-reduction rules discussed earlier, the coefficients in the expression above can be bound such that $a_i \in \mathbb{Z}_8$, $b_{i j} \in \mathbb{Z}_4$, $c_{i j k} \in \mathbb{Z}_2$. For instance, if four $U$ gates are applied on the same pair of qubits, we can use rule 8 to turn them into $T$ gates.

This leads directly to a definition of the diagonal normal form, given by ordering the gates as they appear on the phase polynomial representation. The existence of the normal form comes from the fact that diagonal gates commute and that they are generated by $\omega, T, U$ and $V$. The bounds on coefficients $a_i, b_{i j}$ and $c_{i j k}$ are the main ingredient to prove uniqueness.

The proof of uniqueness for the diagonal normal form proceeds as follows. Suppose $D$ and $D'$ are distinct diagonal normal forms, we want to show that they differ on some input, i.e $\exists y \in \mathbb{Z}_2^n$ such that $D|y\rangle \neq D'|y\rangle$. By construction $p_D(x) \neq p_{D'}(x)$ as polynomials. However, because of the use of mixed arithmetic in the polynomial expression, this does not mean that there is a $y \in \mathbb{Z}_2^n$ such that $p_D(y) \neq p_{D'}(y)$. The following is a counterexample:
$4x_1 + 4x_2 + 4(x_1 \oplus x_2) = 0$ mod $8$ for any $x_1, x_2 \in \mathbb{Z}_2$.

The existence of such an input $y$ comes from the bounds on the coefficients $a_i$, $b_{i j}$ and $c_{i j k}$. Applying to the terms in $p_D - p_{D'}$ the following translation from mod $2$ to mod $8$:
$$ x_i \oplus x_j = x_i + x_j -2x_i x_j$$
$$ \quad x_i \oplus x_j \oplus x_k = x_i + x_j + x_k -2x_i x_j -2x_i x_k -2x_j x_k + 4x_i x_j x_k$$
which holds for any $x_i, x_j, x_k \in \mathbb{Z}_2$. We see that given the bounds on the coefficients, this will yield a non-zero polynomial $q: \mathbb{Z}^n_8 \rightarrow \mathbb{Z}_8$ which is equal to $p_D - p_{D'}$ for inputs in $\mathbb{Z}_2$. Finally, picking a non-zero term $d x_{i_1} \dots x_{i_k}$ in $q(x)$ and letting $y$ have $1$'s in $i_j$th positions and zero everywhere else, we obtain $q(y) = d \neq 0$ and so $D|y\rangle \neq D' |y\rangle$.



## Diagonal gates in ZX: reducing $T$-count with the ZX-calculus.

We have seen that phase polynomials are a useful technique for normalising diagonal circuits and distinguish between them. Degree reduction rules as well as rule 13 in the paper are directly imported from this formalism. We have seen that most of those rules can be derived from the ZX calculus, although rules 9 and 13 are very hard to show. In this section we import those rules to the ZX calculus. We introduce diagrammatic phase gadgets to represent the diagonal circuits and show that we can reduce T-count in ZX using the phase polynomial formalism.

<img width = "700" src = "https://raw.githubusercontent.com/leolobski/CNOT-dihedral/master/assets/R13.png"
alt = ""/>

## Future work

As the authors of the paper remark in the conclusion, their result does not provide an algorithm to rewrite an arbitrary CNOT-dihedral circuit, as the rules of a monoidal category are non-constructive. Thus the next natural question to ask is how to find such an algorithm.

By removing the $X$ gate from the gate set considered in the paper, one obtains a normal form for the gate set $\{C N O T, T\}$. Thus the only gate missing to turn this into the Clifford+T gate set is the Hadamard gate. Since the ZX-calculus for the Clifford+T gate set is known to be approximately universal for quantum computation, it would be of great interest to know whether there is a normal form for this fragment as well. This is currently an open problem. However, the authors make a combinatorial argument showing that including the Hadamard gate increases the number of diagonal gates dramatically. This suggests that the problem is not an easy generalisation of the results of the paper.

As we have seen, the phase polynomials are an efficient tool informing both existence and uniqueness proofs of the normal form. Thus there is a chance similar techniques involving the phase polynomials can be applied to other fragments of quantum computation and associated graphical languages.
